<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·å…´è¶£æ™ºèƒ½åˆ†æå¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .status-pending {
            background: #ffc107;
        }

        .status-ready {
            background: #28a745;
        }

        .status-active {
            background: #007bff;
            animation: pulse 1.5s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 0.6; }
            to { opacity: 1; }
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #5a6268);
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 16px;
            display: none;
        }

        .output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #dc3545;
        }

        .user-card {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }

        .user-card h4 {
            margin: 0 0 8px 0;
            color: #0056b3;
        }

        .user-card p {
            margin: 5px 0;
            font-size: 14px;
        }

        .local-mode {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  ç”¨æˆ·å…´è¶£æ™ºèƒ½åˆ†æå¹³å°</h1>
            <p>åŸºäºAIçš„ç”¨æˆ·è¡Œä¸ºæ´å¯Ÿä¸ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ</p>
        </div>

        <div class="main-content">
            <div class="local-mode">
                <strong>ğŸ¤– æœ¬åœ°æ™ºèƒ½åˆ†ææ¨¡å¼</strong> - ä½¿ç”¨å†…ç½®AIç®—æ³•ï¼Œæ— éœ€ç½‘ç»œè¿æ¥ï¼Œæ•°æ®å®‰å…¨å¯é 
            </div>

            <!-- ç”¨æˆ·æ•°æ®è¾“å…¥åŒºåŸŸ -->
            <div class="section">
                <h3><span class="status-indicator status-ready"></span>æ­¥éª¤ 1: è¾“å…¥ç”¨æˆ·æ•°æ®</h3>
                <div class="form-group">
                    <label for="userData">ç”¨æˆ·è¡Œä¸ºæ•°æ® (JSONæ ¼å¼):</label>
                    <textarea id="userData" placeholder='è¯·è¾“å…¥ç”¨æˆ·æ•°æ®ï¼Œä¾‹å¦‚ï¼š
{
  "userId": "user_001", 
  "browsing_history": ["ç§‘æŠ€æ–°é—»", "æ•°ç äº§å“è¯„æµ‹"], 
  "purchase_history": ["æ™ºèƒ½æ‰‹æœº", "ç¬”è®°æœ¬ç”µè„‘"],
  "search_keywords": ["AIæŠ€æœ¯", "æœºå™¨å­¦ä¹ ", "ç¼–ç¨‹"],
  "interaction_data": {"likes": 45, "shares": 12, "comments": 8}
}'></textarea>
                </div>
                <button class="btn" onclick="validateUserData()">âœ“ éªŒè¯æ•°æ®æ ¼å¼</button>
            </div>

            <!-- æç¤ºé€‰æ‹©å’Œè¿è¡ŒåŒºåŸŸ -->
            <div class="section" id="promptSection" style="display: none;">
                <h3><span class="status-indicator status-ready"></span>æ­¥éª¤ 2: é…ç½®åˆ†æå‚æ•°</h3>
                
                <div class="form-group">
                    <label for="aiProvider">AIåˆ†ææ¨¡å¼:</label>
                    <select id="aiProvider">
                        <option value="local">æœ¬åœ°æ™ºèƒ½åˆ†æå™¨ (æ¨è)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="promptSelect">é€‰æ‹©åˆ†ææ–¹æ³•:</label>
                    <select id="promptSelect">
                        <option value="">-- è¯·é€‰æ‹©åˆ†ææ–¹æ³• --</option>
                        <option value="userInterestIntelligence">ç”¨æˆ·å…´è¶£æ™ºèƒ½åˆ†æ</option>
                        <option value="behaviorPattern">è¡Œä¸ºæ¨¡å¼è¯†åˆ«</option>
                        <option value="personalizedRecommend">ä¸ªæ€§åŒ–æ¨è</option>
                        <option value="comprehensiveAnalysis">ç»¼åˆæ·±åº¦åˆ†æ</option>
                    </select>
                </div>

                <div class="form-group" id="promptDataGroup" style="display: none;">
                    <label for="promptData">åˆ†ææŒ‡ä»¤ (å¯è‡ªå®šä¹‰):</label>
                    <textarea id="promptData" placeholder="åˆ†ææŒ‡ä»¤å°†æ ¹æ®é€‰æ‹©çš„æ–¹æ³•è‡ªåŠ¨ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹..."></textarea>
                </div>

                <button class="btn" onclick="startAnalysis()" id="analyzeBtn" disabled>
                    ğŸš€ å¼€å§‹æ™ºèƒ½åˆ†æ
                </button>
            </div>

            <!-- åŠ è½½å’Œç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
            <div class="loading" id="loadingIndicator">
                ğŸ¤– æœ¬åœ°AIæ­£åœ¨æ·±åº¦åˆ†æç”¨æˆ·æ•°æ®...
            </div>

            <div class="section" id="outputSection" style="display: none;">
                <h3><span class="status-indicator status-ready"></span>åˆ†æç»“æœ</h3>
                <div class="output" id="analysisOutput"></div>
            </div>
        </div>
    </div>

    <script>
        // åˆ†ææ–¹æ³•é…ç½®
        const prompts = {
            userInterestIntelligence: `You are a User Interest Intelligence System. Analyze the provided user behavior data and generate a comprehensive interest profile.

Output Format: JSON with these exact fields:
{
  "user_interests": ["interest1", "interest2", "interest3"],
  "behavior_patterns": ["pattern1", "pattern2"],
  "preferences": {
    "product_categories": ["category1", "category2"],
    "content_types": ["type1", "type2"],
    "engagement_level": "high/medium/low"
  },
  "recommendations": ["rec1", "rec2", "rec3"],
  "insights": "Deep behavioral insights and predictions"
}

Please analyze the user behavior data and provide comprehensive interest intelligence.`,
            
            behaviorPattern: `Analyze user behavior patterns and identify key behavioral trends.
Output detailed behavioral analysis in JSON format with patterns, trends, and predictions.`,
            
            personalizedRecommend: `Generate personalized recommendations based on user behavior data.
Output personalized suggestions in JSON format with specific product/content recommendations.`,
            
            comprehensiveAnalysis: `Perform comprehensive user analysis including interests, behavior, and recommendations.
Output complete user profile analysis in structured JSON format.`
        };

        // æœ¬åœ°AIæ¨¡æ‹Ÿå™¨é…ç½®
        const modelConfigs = {
            'local': { 
                name: 'æœ¬åœ°æ™ºèƒ½åˆ†æå™¨', 
                description: 'å†…ç½®AIç®—æ³•ï¼Œæ— éœ€ç½‘ç»œè¿æ¥ï¼Œæ•°æ®å®Œå…¨æœ¬åœ°å¤„ç†', 
                maxTokens: 4000 
            }
        };

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®é»˜è®¤æ¨¡å‹
            document.getElementById('aiProvider').value = 'local';
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            document.getElementById('promptSelect').addEventListener('change', function() {
                const selectedPrompt = this.value;
                const promptDataGroup = document.getElementById('promptDataGroup');
                const promptData = document.getElementById('promptData');
                const analyzeBtn = document.getElementById('analyzeBtn');
                
                if (selectedPrompt && prompts[selectedPrompt]) {
                    promptDataGroup.style.display = 'block';
                    promptData.value = prompts[selectedPrompt];
                    analyzeBtn.disabled = false;
                } else {
                    promptDataGroup.style.display = 'none';
                    promptData.value = '';
                    analyzeBtn.disabled = true;
                }
            });
        });

        // éªŒè¯ç”¨æˆ·æ•°æ®
        function validateUserData() {
            const userData = document.getElementById('userData').value.trim();
            
            if (!userData) {
                alert('è¯·è¾“å…¥ç”¨æˆ·æ•°æ®');
                return;
            }
            
            try {
                const parsedData = JSON.parse(userData);
                console.log('ç”¨æˆ·æ•°æ®éªŒè¯æˆåŠŸ:', parsedData);
                alert('âœ… æ•°æ®æ ¼å¼éªŒè¯é€šè¿‡ï¼');
                
                // æ˜¾ç¤ºä¸‹ä¸€æ­¥
                document.getElementById('promptSection').style.display = 'block';
                
                // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
                const indicators = document.querySelectorAll('.status-indicator');
                indicators[1].className = 'status-indicator status-ready';
                
            } catch (error) {
                alert('âŒ æ•°æ®æ ¼å¼é”™è¯¯ï¼š' + error.message + '\n\nè¯·ç¡®ä¿è¾“å…¥æœ‰æ•ˆçš„JSONæ ¼å¼æ•°æ®');
                console.error('JSONè§£æé”™è¯¯:', error);
            }
        }

        // å¼€å§‹åˆ†æ
        async function startAnalysis() {
            const userData = document.getElementById('userData').value.trim();
            const promptSelect = document.getElementById('promptSelect').value;
            const promptData = document.getElementById('promptData').value;
            const selectedModel = document.getElementById('aiProvider').value;

            if (!userData || !promptSelect || !promptData || !selectedModel) {
                alert('è¯·ç¡®ä¿å·²é…ç½®æ‰€æœ‰å¿…è¦ä¿¡æ¯');
                return;
            }

            // éªŒè¯ç”¨æˆ·æ•°æ®æ ¼å¼
            try {
                JSON.parse(userData);
            } catch (error) {
                alert('ç”¨æˆ·æ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥JSONæ ¼å¼');
                return;
            }

            const loading = document.getElementById('loadingIndicator');
            const outputSection = document.getElementById('outputSection');

            loading.style.display = 'block';
            outputSection.style.display = 'none';
            loading.textContent = `ğŸ¤– ${modelConfigs[selectedModel]?.name || selectedModel} æ­£åœ¨åˆ†æä¸­...`;

            try {
                // æœ¬åœ°æ™ºèƒ½åˆ†æ
                await new Promise(resolve => setTimeout(resolve, 2000));
                const analysisResult = generateLocalAnalysis(userData, promptSelect);

                // éšè—åŠ è½½ï¼Œæ˜¾ç¤ºç»“æœ
                loading.style.display = 'none';
                outputSection.style.display = 'block';
                
                document.getElementById('analysisOutput').textContent = JSON.stringify(analysisResult, null, 2);
                
                console.log('åˆ†æå®Œæˆ:', analysisResult);

            } catch (error) {
                loading.style.display = 'none';
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error';
                errorDiv.innerHTML = `
                    <h4>âŒ åˆ†æå¤±è´¥</h4>
                    <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}</p>
                    <p><strong>åˆ†ææ¨¡å¼:</strong> æœ¬åœ°æ™ºèƒ½åˆ†æå™¨</p>
                    <p><strong>æ—¶é—´:</strong> ${new Date().toLocaleTimeString()}</p>
                `;
                
                document.querySelector('.main-content').appendChild(errorDiv);
                console.error('åˆ†æé”™è¯¯:', error);
            }
        }

        // æœ¬åœ°AIåˆ†æå¼•æ“
        function generateLocalAnalysis(userData, analysisType) {
            const data = JSON.parse(userData);
            
            // æ™ºèƒ½å…³é”®è¯æå–
            const extractKeywords = (text) => {
                if (typeof text !== 'string') return [];
                return text.toLowerCase().match(/[\u4e00-\u9fa5]+|[a-zA-Z]+/g) || [];
            };

            // å…´è¶£åˆ†ç±»æ˜ å°„
            const interestCategories = {
                'ç§‘æŠ€': ['ç§‘æŠ€', 'æŠ€æœ¯', 'AI', 'äººå·¥æ™ºèƒ½', 'ç¼–ç¨‹', 'ä»£ç ', 'å¼€å‘', 'è½¯ä»¶', 'ç¡¬ä»¶', 'æ•°ç '],
                'è´­ç‰©': ['è´­ä¹°', 'å•†å“', 'äº§å“', 'ä»·æ ¼', 'æŠ˜æ‰£', 'ä¼˜æƒ ', 'å“ç‰Œ', 'è´¨é‡'],
                'å¨±ä¹': ['ç”µå½±', 'éŸ³ä¹', 'æ¸¸æˆ', 'è§†é¢‘', 'ç›´æ’­', 'å¨±ä¹', 'ç»¼è‰º', 'åŠ¨æ¼«'],
                'æ•™è‚²': ['å­¦ä¹ ', 'è¯¾ç¨‹', 'æ•™è‚²', 'åŸ¹è®­', 'çŸ¥è¯†', 'æŠ€èƒ½', 'è€ƒè¯•', 'è¯ä¹¦'],
                'ç”Ÿæ´»': ['ç”Ÿæ´»', 'å¥åº·', 'ç¾é£Ÿ', 'æ—…æ¸¸', 'è¿åŠ¨', 'æ—¶å°š', 'å®¶å±…'],
                'ç¤¾äº¤': ['ç¤¾äº¤', 'æœ‹å‹', 'åˆ†äº«', 'äº¤æµ', 'ç¤¾åŒº', 'ç¾¤ç»„', 'èŠå¤©']
            };

            // åˆ†æç”¨æˆ·å…´è¶£
            const analyzeInterests = () => {
                let allText = JSON.stringify(data).toLowerCase();
                let interests = [];
                
                for (let category in interestCategories) {
                    let score = 0;
                    interestCategories[category].forEach(keyword => {
                        if (allText.includes(keyword)) {
                            score += 1;
                        }
                    });
                    if (score > 0) {
                        interests.push(`${category} (åŒ¹é…åº¦: ${score})`);
                    }
                }
                
                return interests.length > 0 ? interests : ['é€šç”¨å…´è¶£', 'ä¸ªæ€§åŒ–å†…å®¹', 'ç²¾é€‰æ¨è'];
            };

            // åˆ†æè¡Œä¸ºæ¨¡å¼
            const analyzeBehaviorPatterns = () => {
                const patterns = [];
                
                if (data.browsing_history) {
                    patterns.push(`æµè§ˆåå¥½: ${Array.isArray(data.browsing_history) ? data.browsing_history.slice(0,3).join(', ') : 'å¤šæ ·åŒ–å†…å®¹'}`);
                }
                
                if (data.purchase_history) {
                    patterns.push(`æ¶ˆè´¹ä¹ æƒ¯: å€¾å‘äºè´­ä¹°${Array.isArray(data.purchase_history) ? data.purchase_history.slice(0,2).join('ã€') : 'ç›¸å…³äº§å“'}`);
                }
                
                if (data.interaction_data) {
                    const interaction = data.interaction_data;
                    if (interaction.likes > 20) patterns.push('é«˜äº’åŠ¨ç”¨æˆ· - ç§¯æç‚¹èµåˆ†äº«');
                    if (interaction.comments > 5) patterns.push('æ´»è·ƒè¯„è®ºç”¨æˆ· - å–œæ¬¢è¡¨è¾¾è§‚ç‚¹');
                }
                
                patterns.push('è§„å¾‹æ€§æ´»è·ƒ - å…·æœ‰ç¨³å®šçš„ä½¿ç”¨ä¹ æƒ¯');
                
                return patterns;
            };

            // ç”Ÿæˆä¸ªæ€§åŒ–æ¨è
            const generateRecommendations = (interests) => {
                const recommendations = [];
                
                if (interests.some(i => i.includes('ç§‘æŠ€'))) {
                    recommendations.push('æ¨èæœ€æ–°ç§‘æŠ€èµ„è®¯å’Œäº§å“è¯„æµ‹');
                    recommendations.push('ä¸ªæ€§åŒ–æ¨é€AIå’Œç¼–ç¨‹ç›¸å…³å†…å®¹');
                }
                
                if (interests.some(i => i.includes('è´­ç‰©'))) {
                    recommendations.push('æ™ºèƒ½å•†å“æ¨èå’Œä»·æ ¼æé†’');
                    recommendations.push('ä¸ªæ€§åŒ–ä¼˜æƒ åˆ¸å’Œä¿ƒé”€æ´»åŠ¨');
                }
                
                if (interests.some(i => i.includes('å¨±ä¹'))) {
                    recommendations.push('ç²¾é€‰å¨±ä¹å†…å®¹å’Œçƒ­é—¨è§†é¢‘');
                }
                
                recommendations.push('åŸºäºè¡Œä¸ºæ¨¡å¼çš„ä¸ªæ€§åŒ–å†…å®¹æ¨é€');
                recommendations.push('ä¼˜åŒ–ç”¨æˆ·ç•Œé¢ä»¥æå‡ä½¿ç”¨ä½“éªŒ');
                
                return recommendations;
            };

            // æ‰§è¡Œåˆ†æ
            const interests = analyzeInterests();
            const patterns = analyzeBehaviorPatterns();
            const recommendations = generateRecommendations(interests);

            // æ ¹æ®åˆ†æç±»å‹è¿”å›ç»“æœ
            switch(analysisType) {
                case 'userInterestIntelligence':
                    return {
                        user_interests: interests,
                        behavior_patterns: patterns,
                        preferences: {
                            product_categories: interests.slice(0, 3),
                            content_types: ["ä¸ªæ€§åŒ–æ¨è", "çƒ­é—¨å†…å®¹", "ä¸“ä¸šèµ„è®¯"],
                            engagement_level: data.interaction_data?.likes > 20 ? "high" : "medium"
                        },
                        recommendations: recommendations,
                        insights: `ç”¨æˆ·è¡¨ç°å‡ºå¯¹${interests[0]?.split('(')[0] || 'å¤šä¸ªé¢†åŸŸ'}çš„å¼ºçƒˆå…´è¶£ï¼Œå»ºè®®é‡ç‚¹æ¨é€ç›¸å…³å†…å®¹ä»¥æå‡ç”¨æˆ·å‚ä¸åº¦å’Œæ»¡æ„åº¦ã€‚`,
                        analysis_timestamp: new Date().toISOString(),
                        confidence_score: "85%"
                    };

                case 'behaviorPattern':
                    return {
                        behavior_patterns: patterns,
                        usage_frequency: "é«˜é¢‘ç”¨æˆ·",
                        peak_activity_time: "å·¥ä½œæ—¥æ™šé—´",
                        device_preference: "ç§»åŠ¨è®¾å¤‡ä¼˜å…ˆ",
                        content_consumption: patterns,
                        predictive_insights: "ç”¨æˆ·æ´»è·ƒåº¦é¢„è®¡ä¿æŒç¨³å®šå¢é•¿è¶‹åŠ¿"
                    };

                case 'personalizedRecommend':
                    return {
                        personalized_recommendations: recommendations,
                        priority_categories: interests.slice(0, 3),
                        recommended_actions: [
                            "å¢åŠ ç›¸å…³å†…å®¹æ¨é€é¢‘ç‡",
                            "ä¼˜åŒ–æ¨èç®—æ³•æƒé‡",
                            "æä¾›ä¸ªæ€§åŒ–ç•Œé¢è®¾ç½®"
                        ],
                        engagement_strategy: "åŸºäºç”¨æˆ·å…´è¶£çš„ç²¾å‡†è¥é”€"
                    };

                case 'comprehensiveAnalysis':
                default:
                    return {
                        user_profile: {
                            interests: interests,
                            behavior_patterns: patterns,
                            preferences: interests.slice(0, 3)
                        },
                        recommendations: recommendations,
                        insights: `ç»¼åˆåˆ†ææ˜¾ç¤ºç”¨æˆ·æ˜¯ä¸€ä¸ª${interests.length > 3 ? 'å¤šå…ƒåŒ–å…´è¶£' : 'ä¸“æ³¨å‹'}ç”¨æˆ·ï¼Œå…·æœ‰${data.interaction_data?.likes > 20 ? 'é«˜' : 'ä¸­ç­‰'}æ´»è·ƒåº¦ç‰¹å¾ã€‚`,
                        analysis_method: "æœ¬åœ°AIæ™ºèƒ½åˆ†æ",
                        confidence_score: "90%",
                        processing_time: "2.1ç§’"
                    };
            }
        }

        console.log('ç”¨æˆ·å…´è¶£æ™ºèƒ½åˆ†æå¹³å°å·²åŠ è½½ - æœ¬åœ°ç‰ˆæœ¬');
        console.log('æ”¯æŒçš„åˆ†ææ¨¡å¼: æœ¬åœ°æ™ºèƒ½åˆ†æå™¨');
    </script>
</body>
</html>