<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·å…´è¶£æ™ºèƒ½åˆ†æå¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .main-content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        select, textarea, button {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
            width: auto;
            min-width: 120px;
        }

        button:hover {
            background: linear-gradient(135deg, #2980b9 0%, #21618c 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #7f8c8d 0%, #6c7b7d 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #229954 0%, #1e8449 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
        }

        .data-textarea {
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
        }

        .output-section {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .output-section h3 {
            color: #ecf0f1;
            border-bottom: 2px solid #3498db;
            margin-bottom: 20px;
        }

        .output-content {
            background: #34495e;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #4a5f7a;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #3498db;
        }

        .loading::after {
            content: "â³ åˆ†æä¸­...";
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-ready { background-color: #27ae60; }
        .status-loading { background-color: #f39c12; }
        .status-error { background-color: #e74c3c; }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .prompt-preview {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 12px;
            color: #2c3e50;
            max-height: 150px;
            overflow-y: auto;
            border-left: 4px solid #3498db;
        }

        .result-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .summary-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .summary-card p {
            color: #34495e;
            font-size: 14px;
            line-height: 1.5;
        }

        .interest-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }

        .interest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .interest-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
        }

        .interest-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .meta-badge {
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .interest-rationale {
            background: #ecf0f1;
            padding: 12px;
            border-radius: 6px;
            font-style: italic;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .interest-keywords {
            margin-bottom: 10px;
        }

        .keyword-tag {
            display: inline-block;
            background: #95a5a6;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            margin: 2px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ç”¨æˆ·å…´è¶£æ™ºèƒ½åˆ†æå¹³å°</h1>
            <p>åŸºäºè¡Œä¸ºæ•°æ®çš„ä¸“ä¸šçº§å…´è¶£ç”»åƒåˆ†æç³»ç»Ÿ</p>
        </div>

        <div class="main-content">
            <!-- ç”¨æˆ·é€‰æ‹©åŒºåŸŸ -->
            <div class="section">
                <h3><span class="status-indicator status-ready"></span>æ­¥éª¤ 1: é€‰æ‹©ç”¨æˆ·</h3>
                <div class="form-group">
                    <label for="userSelect">é€‰æ‹©ç”¨æˆ·IDï¼š</label>
                    <select id="userSelect">
                        <option value="">-- è¯·é€‰æ‹©ç”¨æˆ· --</option>
                        <option value="user1">User1</option>
                    </select>
                </div>
                <button id="getUserBehaviorBtn" onclick="getUserBehavior()" disabled>è·å–ç”¨æˆ·è¡Œä¸ºæ•°æ®</button>
            </div>

            <!-- æ•°æ®ç¼–è¾‘åŒºåŸŸ -->
            <div class="section" id="dataSection" style="display: none;">
                <h3><span class="status-indicator status-ready"></span>æ­¥éª¤ 2: ç¼–è¾‘ç”¨æˆ·æ•°æ®</h3>
                <div class="form-group">
                    <label for="userData">ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼š</label>
                    <textarea id="userData" class="data-textarea" placeholder="ç”¨æˆ·æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º..."></textarea>
                </div>
                <div class="button-group">
                    <button id="editBtn" onclick="toggleEdit()">ç¼–è¾‘æ•°æ®</button>
                    <button id="saveBtn" onclick="saveData()" style="display: none;" class="btn-success">ä¿å­˜æ•°æ®</button>
                    <button id="cancelBtn" onclick="cancelEdit()" style="display: none;" class="btn-secondary">å–æ¶ˆç¼–è¾‘</button>
                </div>
            </div>

            <!-- æç¤ºé€‰æ‹©å’Œè¿è¡ŒåŒºåŸŸ -->
            <div class="section" id="promptSection" style="display: none;">
                <h3><span class="status-indicator status-ready"></span>æ­¥éª¤ 3: é…ç½®AIæœåŠ¡</h3>
                
                <!-- APIé…ç½®åŒºåŸŸ -->
                <div class="form-group">
                    <label for="aiProvider">é€‰æ‹©AIæœåŠ¡å•†ï¼š</label>
                    <select id="aiProvider">
                        <option value="">-- è¯·é€‰æ‹©AIæœåŠ¡ --</option>
                        <option value="openai">OpenAI (GPT-4/3.5)</option>
                        <option value="claude">Anthropic Claude</option>
                        <option value="gemini">Google Gemini</option>
                        <option value="local">æœ¬åœ°æ¨¡æ‹Ÿï¼ˆæµ‹è¯•ç”¨ï¼‰</option>
                    </select>
                </div>
                
                <div class="form-group" id="apiKeySection" style="display: none;">
                    <label for="apiKey">APIå¯†é’¥ï¼š</label>
                    <input type="password" id="apiKey" placeholder="è¾“å…¥ä½ çš„APIå¯†é’¥" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
                    <small style="color: #7f8c8d;">å¯†é’¥ä»…åœ¨æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨</small>
                </div>
                
                <div class="form-group">
                    <label for="promptSelect">é€‰æ‹©åˆ†ææç¤ºï¼š</label>
                    <select id="promptSelect">
                        <option value="">-- è¯·é€‰æ‹©åˆ†ææ¨¡å‹ --</option>
                        <option value="user-interest-intelligence-prompt_testV1.md">ç”¨æˆ·å…´è¶£æ™ºèƒ½åˆ†æ v1.0</option>
                    </select>
                </div>
                <div class="form-group" id="promptEditSection" style="display: none;">
                    <label for="promptData">åˆ†ææç¤ºå†…å®¹ï¼š</label>
                    <textarea id="promptData" class="data-textarea" placeholder="æç¤ºå†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º..." style="min-height: 150px;"></textarea>
                </div>
                <div class="prompt-preview" id="promptPreview" style="display: none;">
                    <strong>æç¤ºé¢„è§ˆï¼š</strong><br>
                    <span id="promptContent"></span>
                </div>
                <div class="button-group">
                    <button id="editPromptBtn" onclick="togglePromptEdit()" style="display: none;">ç¼–è¾‘æç¤º</button>
                    <button id="savePromptBtn" onclick="savePrompt()" style="display: none;" class="btn-success">ä¿å­˜æç¤º</button>
                    <button id="cancelPromptBtn" onclick="cancelPromptEdit()" style="display: none;" class="btn-secondary">å–æ¶ˆç¼–è¾‘</button>
                    <button id="runAnalysisBtn" onclick="runAnalysis()" disabled class="btn-warning">ğŸš€ è¿è¡Œåˆ†æ</button>
                </div>
            </div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div class="loading" id="loadingIndicator"></div>

            <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
            <div class="output-section" id="outputSection" style="display: none;">
                <h3><span class="status-indicator status-ready"></span>User Profile</h3>
                <div class="result-summary" id="resultSummary"></div>
                <div class="interests-display" id="interestsDisplay"></div>
                <div class="output-content" id="outputContent" style="display: none;"></div>
                <button onclick="toggleRawOutput()" class="btn-secondary" style="margin-top: 15px;">Show/Hide Raw JSON</button>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿçš„ç”¨æˆ·æ•°æ®
        const userData = {
            "user1": `# INPUT CurrentDate
2026-01-14

# Input Daily User Behavior (2026-01-13)
UserId   Date   DetailedSource   Source   Action
User1    1/13/2026 12:00:00 AM   MSN View MSN   'Godfather of AI' says the technology will create massive unemployment and send profits soaring â€” 'that is the capitalist system'
User1    1/13/2026 12:00:00 AM   MSN View MSN   Cyclist sees kitten shivering on side of road, his next move saves her life
User1    1/13/2026 12:00:00 AM   BrowserEvents  Edge  'Godfather of AI' says the technology will create massive unemployment and send profits soaring â€” 'that is the capitalist system'

# INPUT Historical User Interest Profile (Up to 2026-01-12)
User Id  Market   From Date   To Date  Category    Sub Category   Keywords    Source   Weight   Duration
User1 en-us 2025-02-19  2026-01-11  Fashion & Style   Coats and Outerwear  Cinch-Waist Puffer, Frost Fall Hooded Jacket, Wunder Puff Jacket, Frost Fall Parka, Men's Wunder Puff Jacket, Water-Resistant Cropped Hooded Jacket, Ventilated Running Jacket, Down for It All Jacket, Wunder Puff Vest, Dance Studio Jogger   Uet   0.969109763210974 long-term
User1 en-us 2025-02-12  2026-01-11  Fashion & Style   Footwear Zuri Strappy Ballet Flat, Sam Edelman, Liona Bit Loafer, Dance Studio, Lucca Loafer, Women's Shoes, Merrell, Sam Edelman Lucca Loafer, McQueen Oversized Sneaker, Tory Burch Field Sneaker   Uet   0.954369690971561 long-term
User1 en-us 2025-09-27  2026-01-11  Fashion & Style   Makeup and Accessories  New Crew Backpack, Augustinus Bader, City Essentials Bag, Burberry 54mm Gradient Cat Eye Sunglasses, Fendi Fine 59mm Round Sunglasses, EstÃ©e Lauder, Everywhere Crossbody Bag, Sport Bottle, UA Studio Luna Shoulder Bag, Metal Aviator Sunglass   Uet   0.940856079579912 long-term
User1 en-us 2025-02-12  2026-01-07  Fashion & Style   Women's Fashion   Sam Edelman, Lucca Loafer, Loraine Bit Loafer, Atmos Rewards, Tempo Track Pant, Maeve Cocktail Tee, Shrunken Bennet Shirt, Tory Burch, Vince, Ted Baker  Uet   0.852432921917494 long-term
User1 en-us 2025-08-02  2026-01-08  Fashion & Style   Loungewear  Softstreme High-Rise Straight-Leg Pant, Relaxed-Fit Cotton T-Shirt, Scuba Hoodie, Dance Studio Pant, Beach Riot Cardigan, Graphic Sweater, Crewneck Sweatshirt, Cashmere Cardigan, Glazed Satin Long Pajama Set   Uet   0.848047116791127 long-term
User1 en-us 2026-01-09  2026-01-12  Technology  Cloud Computing   Azure ExP Studio, Analysis Hub, Azure Data Explorer   Edge  0.830496 long-term
User1 en-us 2025-10-05  2026-01-09  Travel & Attractions Air Travel  San JosÃ© Mineta Intl. Airport, Alaska Airlines, Flights, Flight Status  Edge  0.803908934176482 long-term
User1 en-us 2025-02-19  2026-01-04  Technology  Artificial Intelligence Elon Musk's Brain-Implant Company, Artificial Intelligence, AI, OpenAI, Copilot adoption, Copilot Adoption, AI Product, AI-generated headlines, Microsoft AI, ChatGPT   Edge, MSN   0.782687556682147 long-term
User1 en-us 2025-03-12  2026-01-09  Technology  Tech Companies Microsoft, Nvidia, Arm CEO, Broadcom, Apple, Google   Edge  0.771094234671253 long-term
User1 en-us 2025-12-12  2026-01-03  Business & Finance   Investment Firms  Fidelity Investments, Fidelity, Fidelity International   Uet, Bing, MSN 0.770218160923428 long-term`
        };

        // æ¨¡æ‹Ÿçš„æç¤ºæ•°æ®
        const prompts = {
            "user-interest-intelligence-prompt_testV1.md": `# ROLE
You are an expert in User Interest Intelligence, Behavioral Signal Analysis, and Demographic Profiling.
Your task is to synthesize one day's raw user behavior together with existing user interest signals into a concise, professional-grade Interest Profile suitable for downstream personalization, analytics, or modeling systems.

# INSTRUCTIONS
1. Interest Processing & Prioritization
2. Niche Spike Extraction
3. Duration Calculation
4. Rationale Analysis
5. Demographic Synthesis

# OUTPUT
Return ONLY valid, parseable JSON.`
        };

        let isEditing = false;
        let originalData = '';
        let isPromptEditing = false;
        let originalPromptData = '';

        // ç”¨æˆ·é€‰æ‹©å˜åŒ–
        document.getElementById('userSelect').addEventListener('change', function() {
            const getUserBtn = document.getElementById('getUserBehaviorBtn');
            getUserBtn.disabled = !this.value;
            
            if (!this.value) {
                document.getElementById('dataSection').style.display = 'none';
                document.getElementById('promptSection').style.display = 'none';
                document.getElementById('outputSection').style.display = 'none';
            }
        });

        // AIæœåŠ¡å•†é€‰æ‹©å˜åŒ–
        document.getElementById('aiProvider').addEventListener('change', function() {
            const apiKeySection = document.getElementById('apiKeySection');
            
            if (this.value && this.value !== 'local') {
                apiKeySection.style.display = 'block';
            } else {
                apiKeySection.style.display = 'none';
            }
            
            updateRunButton();
        });
        
        // æ›´æ–°è¿è¡ŒæŒ‰é’®çŠ¶æ€
        function updateRunButton() {
            const aiProvider = document.getElementById('aiProvider').value;
            const promptSelect = document.getElementById('promptSelect').value;
            const apiKey = document.getElementById('apiKey').value;
            const runBtn = document.getElementById('runAnalysisBtn');
            
            const isReady = promptSelect && aiProvider && (aiProvider === 'local' || apiKey.trim());
            runBtn.disabled = !isReady;
        }
        
        // APIå¯†é’¥è¾“å…¥å˜åŒ–
        document.getElementById('apiKey').addEventListener('input', updateRunButton);

        // æç¤ºé€‰æ‹©å˜åŒ–
        document.getElementById('promptSelect').addEventListener('change', function() {
            const preview = document.getElementById('promptPreview');
            const content = document.getElementById('promptContent');
            const editSection = document.getElementById('promptEditSection');
            const editBtn = document.getElementById('editPromptBtn');
            const promptData = document.getElementById('promptData');
            
            if (this.value) {
                preview.style.display = 'block';
                editSection.style.display = 'block';
                editBtn.style.display = 'inline-block';
                content.textContent = prompts[this.value].substring(0, 200) + '...';
                promptData.value = prompts[this.value];
                promptData.readOnly = true;
            } else {
                preview.style.display = 'none';
                editSection.style.display = 'none';
                editBtn.style.display = 'none';
            }
            
            updateRunButton();
        });

        // è·å–ç”¨æˆ·è¡Œä¸ºæ•°æ®
        function getUserBehavior() {
            const userId = document.getElementById('userSelect').value;
            
            if (!userId) {
                alert('è¯·å…ˆé€‰æ‹©ç”¨æˆ·ID');
                return;
            }

            // æ¨¡æ‹ŸAPIè°ƒç”¨
            setTimeout(() => {
                const data = userData[userId];
                document.getElementById('userData').value = data;
                document.getElementById('dataSection').style.display = 'block';
                document.getElementById('promptSection').style.display = 'block';
                
                // æ»šåŠ¨åˆ°æ•°æ®åŒºåŸŸ
                document.getElementById('dataSection').scrollIntoView({ behavior: 'smooth' });
            }, 500);
        }

        // åˆ‡æ¢ç¼–è¾‘æ¨¡å¼
        function toggleEdit() {
            const textarea = document.getElementById('userData');
            const editBtn = document.getElementById('editBtn');
            const saveBtn = document.getElementById('saveBtn');
            const cancelBtn = document.getElementById('cancelBtn');

            if (!isEditing) {
                // è¿›å…¥ç¼–è¾‘æ¨¡å¼
                isEditing = true;
                originalData = textarea.value;
                textarea.readOnly = false;
                textarea.style.borderColor = '#f39c12';
                textarea.focus();
                
                editBtn.style.display = 'none';
                saveBtn.style.display = 'inline-block';
                cancelBtn.style.display = 'inline-block';
            }
        }

        // ä¿å­˜æ•°æ®
        function saveData() {
            const textarea = document.getElementById('userData');
            const editBtn = document.getElementById('editBtn');
            const saveBtn = document.getElementById('saveBtn');
            const cancelBtn = document.getElementById('cancelBtn');

            // é€€å‡ºç¼–è¾‘æ¨¡å¼
            isEditing = false;
            textarea.readOnly = true;
            textarea.style.borderColor = '#ddd';
            
            editBtn.style.display = 'inline-block';
            saveBtn.style.display = 'none';
            cancelBtn.style.display = 'none';

            alert('æ•°æ®å·²ä¿å­˜ï¼');
        }

        // å–æ¶ˆç¼–è¾‘
        function cancelEdit() {
            const textarea = document.getElementById('userData');
            const editBtn = document.getElementById('editBtn');
            const saveBtn = document.getElementById('saveBtn');
            const cancelBtn = document.getElementById('cancelBtn');

            // æ¢å¤åŸå§‹æ•°æ®
            textarea.value = originalData;
            
            // é€€å‡ºç¼–è¾‘æ¨¡å¼
            isEditing = false;
            textarea.readOnly = true;
            textarea.style.borderColor = '#ddd';
            
            editBtn.style.display = 'inline-block';
            saveBtn.style.display = 'none';
            cancelBtn.style.display = 'none';
        }

        // åˆ‡æ¢æç¤ºç¼–è¾‘æ¨¡å¼
        function togglePromptEdit() {
            const textarea = document.getElementById('promptData');
            const editBtn = document.getElementById('editPromptBtn');
            const saveBtn = document.getElementById('savePromptBtn');
            const cancelBtn = document.getElementById('cancelPromptBtn');

            if (!isPromptEditing) {
                // è¿›å…¥ç¼–è¾‘æ¨¡å¼
                isPromptEditing = true;
                originalPromptData = textarea.value;
                textarea.readOnly = false;
                textarea.style.borderColor = '#f39c12';
                textarea.focus();
                
                editBtn.style.display = 'none';
                saveBtn.style.display = 'inline-block';
                cancelBtn.style.display = 'inline-block';
            }
        }

        // ä¿å­˜æç¤º
        function savePrompt() {
            const textarea = document.getElementById('promptData');
            const editBtn = document.getElementById('editPromptBtn');
            const saveBtn = document.getElementById('savePromptBtn');
            const cancelBtn = document.getElementById('cancelPromptBtn');
            const promptSelect = document.getElementById('promptSelect');

            // æ›´æ–°æç¤ºæ•°æ®
            prompts[promptSelect.value] = textarea.value;
            
            // é€€å‡ºç¼–è¾‘æ¨¡å¼
            isPromptEditing = false;
            textarea.readOnly = true;
            textarea.style.borderColor = '#ddd';
            
            editBtn.style.display = 'inline-block';
            saveBtn.style.display = 'none';
            cancelBtn.style.display = 'none';

            alert('æç¤ºå·²ä¿å­˜ï¼');
        }

        // å–æ¶ˆæç¤ºç¼–è¾‘
        function cancelPromptEdit() {
            const textarea = document.getElementById('promptData');
            const editBtn = document.getElementById('editPromptBtn');
            const saveBtn = document.getElementById('savePromptBtn');
            const cancelBtn = document.getElementById('cancelPromptBtn');

            // æ¢å¤åŸå§‹æ•°æ®
            textarea.value = originalPromptData;
            
            // é€€å‡ºç¼–è¾‘æ¨¡å¼
            isPromptEditing = false;
            textarea.readOnly = true;
            textarea.style.borderColor = '#ddd';
            
            editBtn.style.display = 'inline-block';
            saveBtn.style.display = 'none';
            cancelBtn.style.display = 'none';
        }

        // è¿è¡Œåˆ†æ
        async function runAnalysis() {
            const userData = document.getElementById('userData').value;
            const promptSelect = document.getElementById('promptSelect').value;
            const promptData = document.getElementById('promptData').value;
            const aiProvider = document.getElementById('aiProvider').value;
            const apiKey = document.getElementById('apiKey').value;
            
            if (!userData || !promptSelect || !promptData || !aiProvider) {
                alert('è¯·ç¡®ä¿å·²é…ç½®æ‰€æœ‰å¿…è¦ä¿¡æ¯');
                return;
            }
            
            if (aiProvider !== 'local' && !apiKey.trim()) {
                alert('è¯·è¾“å…¥APIå¯†é’¥');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const loading = document.getElementById('loadingIndicator');
            const outputSection = document.getElementById('outputSection');
            const loadingText = document.querySelector('.loading');
            
            loading.style.display = 'block';
            outputSection.style.display = 'none';
            loadingText.innerHTML = `ğŸ¤– æ­£åœ¨è°ƒç”¨ ${getProviderName(aiProvider)} è¿›è¡Œåˆ†æ...`;

            try {
                let analysisResult;
                
                if (aiProvider === 'local') {
                    // æœ¬åœ°æ¨¡æ‹Ÿ
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    analysisResult = generateMockAnalysis();
                } else {
                    // çœŸå®AIè°ƒç”¨
                    analysisResult = await callRealAI(aiProvider, apiKey, promptData, userData);
                }
                
                // éšè—åŠ è½½ï¼Œæ˜¾ç¤ºç»“æœ
                loading.style.display = 'none';
                outputSection.style.display = 'block';
                
                // æ˜¾ç¤ºç»“æœ
                displayResultSummary(analysisResult);
                displayIndividualInterests(analysisResult.Profile);
                document.getElementById('outputContent').textContent = JSON.stringify(analysisResult, null, 2);
                
                // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                outputSection.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                loading.style.display = 'none';
                alert(`åˆ†æå¤±è´¥: ${error.message}`);
            }
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿåˆ†æç»“æœ
        function generateMockAnalysis() {
            return {
                "CurrentDate": "2026-01-14",
                "Demographic": "Professional technology-oriented individual with strong interest in AI and cloud computing, likely working in tech sector or data analytics. Demonstrates sophisticated fashion sense with focus on premium activewear and designer accessories, suggesting middle to upper-middle income bracket. Shows emerging interest in financial planning and wealth management, indicating career progression and financial awareness.",
                "Profile": [
                    {
                        "Name": "AI Employment Impact Analysis",
                        "Rationale": "User engaged with content about AI's impact on unemployment and capitalism, building on existing AI interest. This signals concern about technological disruption in the workplace and economic implications. User likely tracking how AI developments affect job security and economic systems.",
                        "Duration": "emerging",
                        "Lifecycle": "normal",
                        "Domain": "Technology > Artificial Intelligence",
                        "Keywords": ["Godfather of AI", "unemployment", "capitalism", "AI impact"],
                        "Intent": "stay_updated",
                        "FromDate": "2026-01-13",
                        "ToDate": "2026-01-13",
                        "Sources": ["MSN"],
                        "Weight": 0.8
                    },
                    {
                        "Name": "Premium Activewear Fashion",
                        "Rationale": "Long-term sustained interest in high-quality activewear brands like Lululemon. User demonstrates preference for functional yet stylish workout clothing, suggesting active lifestyle combined with fashion consciousness.",
                        "Duration": "stable",
                        "Lifecycle": "normal",
                        "Domain": "Fashion & Style > Activewear",
                        "Keywords": ["Dance Studio", "Varsity", "Crew Backpack", "lululemon"],
                        "Intent": "explore",
                        "FromDate": "2025-07-19",
                        "ToDate": "2026-01-03",
                        "Sources": ["Uet"],
                        "Weight": 0.704
                    }
                ]
            };
        }

        // æ˜¾ç¤ºç»“æœæ‘˜è¦
        function displayResultSummary(result) {
            const summaryContainer = document.getElementById('resultSummary');
            
            // äººå£ç»Ÿè®¡æ‘˜è¦
            const demoCard = document.createElement('div');
            demoCard.className = 'summary-card';
            demoCard.innerHTML = `
                <h4>ğŸ‘¤ User Profile</h4>
                <p>${result.Demographic}</p>
            `;
            
            // å…´è¶£æ•°é‡ç»Ÿè®¡
            const statsCard = document.createElement('div');
            statsCard.className = 'summary-card';
            const interestCount = result.Profile.length;
            const stableCount = result.Profile.filter(p => p.Duration === 'stable').length;
            const emergingCount = result.Profile.filter(p => p.Duration === 'emerging').length;
            
            statsCard.innerHTML = `
                <h4>ğŸ“Š Interest Statistics</h4>
                <p>Total Interests: ${interestCount}<br>
                Stable Interests: ${stableCount}<br>
                Emerging Interests: ${emergingCount}</p>
            `;
            
            // ä¸»è¦å…´è¶£é¢†åŸŸ
            const topInterests = result.Profile.slice(0, 2);
            const interestsCard = document.createElement('div');
            interestsCard.className = 'summary-card';
            interestsCard.innerHTML = `
                <h4>ğŸ¯ Main Interests</h4>
                <p>${topInterests.map(interest => 
                    `â€¢ ${interest.Name} (${interest.Intent})`
                ).join('<br>')}</p>
            `;
            
            // æ¸…ç©ºå¹¶æ·»åŠ æ–°å†…å®¹
            summaryContainer.innerHTML = '';
            summaryContainer.appendChild(demoCard);
            summaryContainer.appendChild(statsCard);
            summaryContainer.appendChild(interestsCard);
        }

        // æ˜¾ç¤ºä¸ªåˆ«å…´è¶£
        function displayIndividualInterests(interests) {
            const container = document.getElementById('interestsDisplay');
            container.innerHTML = '';

            interests.forEach((interest, index) => {
                const interestDiv = document.createElement('div');
                interestDiv.className = 'interest-item';
                
                interestDiv.innerHTML = `
                    <div class="interest-header">
                        <div class="interest-name">${interest.Name}</div>
                        <span class="meta-badge">Weight: ${interest.Weight.toFixed(3)}</span>
                    </div>
                    <div class="interest-meta">
                        <span class="meta-badge">${interest.Duration}</span>
                        <span class="meta-badge">${interest.Intent}</span>
                        <span class="meta-badge">${interest.Lifecycle}</span>
                        <span class="meta-badge">${interest.Domain}</span>
                    </div>
                    <div class="interest-rationale">
                        ${interest.Rationale}
                    </div>
                    <div class="interest-keywords">
                        <strong>Keywords:</strong> 
                        ${interest.Keywords.map(keyword => 
                            `<span class="keyword-tag">${keyword}</span>`
                        ).join('')}
                    </div>
                    <div style="font-size: 0.9em; color: #7f8c8d;">
                        <strong>Sources:</strong> ${interest.Sources.join(', ')} | 
                        <strong>Period:</strong> ${interest.FromDate} to ${interest.ToDate}
                    </div>
                `;
                
                container.appendChild(interestDiv);
            });
        }

        // åˆ‡æ¢åŸå§‹JSONæ˜¾ç¤º
        function toggleRawOutput() {
            const rawOutput = document.getElementById('outputContent');
            if (rawOutput.style.display === 'none') {
                rawOutput.style.display = 'block';
            } else {
                rawOutput.style.display = 'none';
            }
        }

        // è·å–æœåŠ¡å•†åç§°
        function getProviderName(provider) {
            const names = {
                'openai': 'OpenAI GPT',
                'claude': 'Anthropic Claude', 
                'gemini': 'Google Gemini',
                'local': 'æœ¬åœ°æ¨¡æ‹Ÿ'
            };
            return names[provider] || provider;
        }
        
        // è°ƒç”¨çœŸå®AIæœåŠ¡
        async function callRealAI(provider, apiKey, prompt, userData) {
            const fullPrompt = `${prompt}\n\n# USER DATA\n${userData}`;
            
            switch (provider) {
                case 'openai':
                    return await callOpenAI(apiKey, fullPrompt);
                case 'claude':
                    return await callClaude(apiKey, fullPrompt);
                case 'gemini':
                    return await callGemini(apiKey, fullPrompt);
                default:
                    throw new Error('ä¸æ”¯æŒçš„AIæœåŠ¡å•†');
            }
        }
        
        // OpenAI APIè°ƒç”¨
        async function callOpenAI(apiKey, prompt) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [{
                        role: 'user',
                        content: prompt
                    }],
                    temperature: 0.7,
                    max_tokens: 2000
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`OpenAI APIé”™è¯¯: ${error.error?.message || 'Unknown error'}`);
            }
            
            const data = await response.json();
            const result = data.choices[0].message.content;
            
            try {
                return JSON.parse(result);
            } catch (e) {
                throw new Error('AIè¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼');
            }
        }
        
        // Claude APIè°ƒç”¨
        async function callClaude(apiKey, prompt) {
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: 'claude-3-sonnet-20240229',
                    max_tokens: 2000,
                    messages: [{
                        role: 'user',
                        content: prompt
                    }]
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`Claude APIé”™è¯¯: ${error.error?.message || 'Unknown error'}`);
            }
            
            const data = await response.json();
            const result = data.content[0].text;
            
            try {
                return JSON.parse(result);
            } catch (e) {
                throw new Error('AIè¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼');
            }
        }
        
        // Gemini APIè°ƒç”¨
        async function callGemini(apiKey, prompt) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }]
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`Gemini APIé”™è¯¯: ${error.error?.message || 'Unknown error'}`);
            }
            
            const data = await response.json();
            const result = data.candidates[0].content.parts[0].text;
            
            try {
                return JSON.parse(result);
            } catch (e) {
                throw new Error('AIè¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼');
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®æ–‡æœ¬åŸŸä¸ºåªè¯»
            document.getElementById('userData').readOnly = true;
            document.getElementById('promptData').readOnly = true;
        });
    </script>
</body>
</html>