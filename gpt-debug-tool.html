<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT API æµ‹è¯•å·¥å…·ï¼ˆä¿®å¤ç‰ˆï¼‰</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        select, textarea, button {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }
        button:hover {
            background: #005a87;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border-color: #ffeaa7;
        }
        .loading {
            text-align: center;
            color: #007cba;
            font-weight: bold;
        }
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .debug-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– GPT API æµ‹è¯•å·¥å…·ï¼ˆä¿®å¤ç‰ˆï¼‰</h1>
        
        <div class="form-group">
            <label for="modelSelect">é€‰æ‹©GPTæ¨¡å‹ï¼š</label>
            <select id="modelSelect">
                <option value="">-- é€‰æ‹©æ¨¡å‹ --</option>
                <option value="gpt-5.2">GPT-5.2</option>
                <option value="gpt-5.1">GPT-5.1</option>
                <option value="gpt-5">GPT-5</option>
                <option value="o4-mini">O4-Mini</option>
                <option value="o1-mini">O1-Mini</option>
            </select>
        </div>

        <div class="form-group">
            <label for="promptInput">æµ‹è¯•æç¤ºè¯ï¼š</label>
            <textarea id="promptInput" placeholder="è¾“å…¥ä½ æƒ³æµ‹è¯•çš„æç¤ºè¯">Hello, please respond with a simple greeting.</textarea>
        </div>

        <button id="testButton" onclick="testGPTAPI()">ğŸš€ æµ‹è¯• GPT API</button>
        <button id="configButton" onclick="debugConfig()" style="background: #28a745;">ğŸ”§ è°ƒè¯•é…ç½®</button>
        <button id="rawButton" onclick="showRawConfig()" style="background: #fd7e14;">ğŸ“„ æ˜¾ç¤ºåŸå§‹é…ç½®</button>

        <div id="result" style="display: none;"></div>
    </div>

    <script>
        // ä»é…ç½®æ–‡ä»¶ç›´æ¥è¯»å–çš„åŠ å¯†æ•°æ®ï¼ˆä¿æŒåŸå§‹æ ¼å¼ï¼‰
        const RAW_ENCRYPTED_CONFIG = `]6E3OWXxPjsrgKUzf}ryO5Q}ep\\wf5ox]6Yv\\[MsgKnw\\Z<kdV4o\\[Q3g[P|Op<z]Z8kdV8khqY|]V8me53ye6EoepIsO6Mof6EyeqQof}<kfJnwgpY|f5oyem3|PGL4OWD3OWD{O[E|][]s][fNPJ\\3]JQm]GD7\\ZMpQGD8]JL3Q}f|QGQpPWP3PJH3QJTNFpgzgF34OmHNdKU3fKP9O|<mf58pO[Qsepg4eJI|d[U8OZIy\\Znw]ZI}gKY}Pl8yfJYx\\Znx\\[s4fpXx\\5<wO5<z]Z8kdV<|][Qze58}][P2\\[EsO[]ofqQse57<PmD|QV3zQF3zPV4zfpY5dZY6FmEpQJUm\\5TzRJIl]mTzRZUlQGf6PmT}]mH}QGEkQGUnFjsqfKTwQTsrgKUzf}ryO5Q}ep\\wf5ox]6Yv\\[MsgKnw\\Z<kdV4o\\[Q3g[P|Op<z]Z8kdV8khqY|]V8me53ye6EoepIsO5UofJ{yhZ4oeqU}O5gzgF34O5Qr\\[Ty\\5<wfJ{ogJoyeqP2\\[EsO[]ofqQse57<PmD|QV3zPV3zPV4zfpY5dZY6FmEpQJUm\\5TzRJIl]mTzRZUlQGf6PmT}]mH}QGEkQGUnFjsyQF4wdZ8sFpk3gKE}Rl;y\\6Qx]l4}dZ8qgZ{kfpo3hV4ke5IsOZYkf6U4f}Lxe6EoepIsOpI9g[MoOpQyeV<yfJYx\\Zny]JYzeJ<8eZYxgKPye}TweZoxdV<mdJI3O5Qye[Ev][Use58}S5IzdV45][M}dZ<xSWLzPmXwPGHwPGHwfKMogpoogzrz]mUn\\5QnPGkk\\p\\3PGon\\mT6Q}L3P5\\{P}Tz\\WT3]DrNe}HweZoxdTsrgKUzf}ryO5Q}ep\\wf5ox]6Yv\\[MsgKnw\\Z<kdV4o\\[Q3g[P|Op<z]Z8kdV8khqY|]V8me53ye6EoepIsO5UofJ{yhZ4oeqU}O5;{OZ4sepny\\5kkgF<me54zeJY3dZ<xf}<kfJnwgpY|f5oyem3|PGL4OWD{OWD{O[E|][]s][f@`;

        // è°ƒè¯•é…ç½®è§£æè¿‡ç¨‹
        function debugConfig() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">ğŸ” æ­£åœ¨è°ƒè¯•é…ç½®è§£æè¿‡ç¨‹...</div>';

            try {
                console.log('=== å¼€å§‹é…ç½®è°ƒè¯• ===');
                
                // æ­¥éª¤1ï¼šæ¸…ç†æ•°æ®
                const cleanData = RAW_ENCRYPTED_CONFIG.trim();
                console.log('æ­¥éª¤1 - æ¸…ç†åæ•°æ®é•¿åº¦:', cleanData.length);
                console.log('æ­¥éª¤1 - å‰50ä¸ªå­—ç¬¦:', cleanData.substring(0, 50));
                
                // æ­¥éª¤2ï¼šBase64è§£ç 
                let base64Decoded;
                try {
                    base64Decoded = atob(cleanData);
                    console.log('æ­¥éª¤2 - Base64è§£ç æˆåŠŸï¼Œé•¿åº¦:', base64Decoded.length);
                    console.log('æ­¥éª¤2 - è§£ç åå‰50ä¸ªå­—ç¬¦:', base64Decoded.substring(0, 50));
                } catch (e) {
                    throw new Error(`Base64è§£ç å¤±è´¥: ${e.message}`);
                }
                
                // æ­¥éª¤3ï¼šå­—ç¬¦åç§»è§£å¯†ï¼ˆåç§»-3ï¼‰
                let decrypted = '';
                for (let i = 0; i < base64Decoded.length; i++) {
                    decrypted += String.fromCharCode(base64Decoded.charCodeAt(i) - 3);
                }
                console.log('æ­¥éª¤3 - å­—ç¬¦åç§»è§£å¯†å®Œæˆï¼Œé•¿åº¦:', decrypted.length);
                console.log('æ­¥éª¤3 - è§£å¯†åå‰100ä¸ªå­—ç¬¦:', decrypted.substring(0, 100));
                console.log('æ­¥éª¤3 - è§£å¯†åæœ€å100ä¸ªå­—ç¬¦:', decrypted.substring(decrypted.length - 100));
                
                // æ­¥éª¤4ï¼šæŸ¥æ‰¾æ¨¡å‹é…ç½®æ®µ
                const modelSections = decrypted.split('[model:');
                console.log('æ­¥éª¤4 - æ‰¾åˆ°é…ç½®æ®µæ•°:', modelSections.length);
                console.log('æ­¥éª¤4 - æ‰€æœ‰æ®µçš„å¼€å¤´:', modelSections.map(s => s.substring(0, 30)));
                
                // æ­¥éª¤5ï¼šè§£ææ¯ä¸ªæ¨¡å‹
                const configs = {};
                modelSections.slice(1).forEach((section, index) => {
                    console.log(`\\n--- è§£ææ¨¡å‹ ${index + 1} ---`);
                    console.log('åŸå§‹æ®µå†…å®¹å‰200å­—ç¬¦:', section.substring(0, 200));
                    
                    const lines = section.split('\\n').filter(line => line.trim());
                    console.log('æœ‰æ•ˆè¡Œæ•°:', lines.length);
                    
                    if (lines.length === 0) {
                        console.log('è·³è¿‡ç©ºæ®µ');
                        return;
                    }
                    
                    const modelName = lines[0].replace(']', '').trim();
                    console.log('æ¨¡å‹åç§°:', modelName);
                    
                    const config = {};
                    lines.slice(1).forEach((line, lineIndex) => {
                        console.log(`  è¡Œ ${lineIndex + 2}: "${line}"`);
                        if (line.includes('=')) {
                            const equalIndex = line.indexOf('=');
                            const key = line.substring(0, equalIndex).trim();
                            const value = line.substring(equalIndex + 1).trim();
                            if (key && value) {
                                config[key] = value;
                                console.log(`    è§£æ: ${key} = ${value.substring(0, 20)}...`);
                            }
                        }
                    });
                    
                    console.log('é…ç½®å®Œæ•´æ€§æ£€æŸ¥:');
                    console.log('  endpoint:', !!config.endpoint);
                    console.log('  apiKey:', !!config.apiKey);
                    
                    if (config.endpoint && config.apiKey) {
                        configs[modelName] = config;
                        console.log(`âœ… æ¨¡å‹ ${modelName} é…ç½®æˆåŠŸ`);
                    } else {
                        console.log(`âŒ æ¨¡å‹ ${modelName} é…ç½®ä¸å®Œæ•´`);
                    }
                });
                
                console.log('\\n=== æœ€ç»ˆç»“æœ ===');
                console.log('æˆåŠŸè§£æçš„æ¨¡å‹:', Object.keys(configs));
                
                // æ˜¾ç¤ºè°ƒè¯•ç»“æœ
                resultDiv.innerHTML = `
                    <div class="success">
                        <h3>ğŸ” é…ç½®è°ƒè¯•å®Œæˆ</h3>
                        <div class="debug-section">
                            <h4>è§£ææ­¥éª¤ï¼š</h4>
                            <p><strong>1. æ•°æ®æ¸…ç†ï¼š</strong> é•¿åº¦ ${cleanData.length} å­—ç¬¦</p>
                            <p><strong>2. Base64è§£ç ï¼š</strong> é•¿åº¦ ${base64Decoded.length} å­—èŠ‚</p>
                            <p><strong>3. å­—ç¬¦åç§»ï¼š</strong> é•¿åº¦ ${decrypted.length} å­—ç¬¦</p>
                            <p><strong>4. é…ç½®æ®µæ•°ï¼š</strong> ${modelSections.length - 1} ä¸ª</p>
                            <p><strong>5. æˆåŠŸè§£æï¼š</strong> ${Object.keys(configs).length} ä¸ªæ¨¡å‹</p>
                        </div>
                        <div class="debug-section">
                            <h4>å¯ç”¨æ¨¡å‹ï¼š</h4>
                            <p>${Object.keys(configs).length > 0 ? Object.keys(configs).join(', ') : 'æ— '}</p>
                        </div>
                        <details>
                            <summary>è¯¦ç»†é…ç½®ä¿¡æ¯ (ç‚¹å‡»å±•å¼€)</summary>
                            <pre>${JSON.stringify(configs, (key, value) => {
                                if (key === 'apiKey') return value.substring(0, 10) + '...';
                                return value;
                            }, 2)}</pre>
                        </details>
                        <details>
                            <summary>è§£å¯†ååŸå§‹æ•°æ® (ç‚¹å‡»å±•å¼€)</summary>
                            <pre>${decrypted}</pre>
                        </details>
                    </div>
                `;
                
                // å°†é…ç½®ä¿å­˜åˆ°å…¨å±€å˜é‡ä¾›å…¶ä»–å‡½æ•°ä½¿ç”¨
                window.debuggedConfigs = configs;
                
            } catch (error) {
                console.error('è°ƒè¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ é…ç½®è°ƒè¯•å¤±è´¥</h3>
                        <p><strong>é”™è¯¯:</strong> ${error.message}</p>
                        <details>
                            <summary>é”™è¯¯å †æ ˆ (ç‚¹å‡»å±•å¼€)</summary>
                            <pre>${error.stack}</pre>
                        </details>
                    </div>
                `;
            }
        }

        // æ˜¾ç¤ºåŸå§‹é…ç½®
        function showRawConfig() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="warning">
                    <h3>ğŸ“„ åŸå§‹é…ç½®æ•°æ®</h3>
                    <p><strong>æ•°æ®é•¿åº¦:</strong> ${RAW_ENCRYPTED_CONFIG.length} å­—ç¬¦</p>
                    <details>
                        <summary>åŠ å¯†æ•°æ® (ç‚¹å‡»å±•å¼€)</summary>
                        <pre>${RAW_ENCRYPTED_CONFIG}</pre>
                    </details>
                </div>
            `;
        }

        // æµ‹è¯•GPT API
        async function testGPTAPI() {
            const model = document.getElementById('modelSelect').value;
            const prompt = document.getElementById('promptInput').value;
            const resultDiv = document.getElementById('result');
            const testButton = document.getElementById('testButton');

            if (!model || !prompt) {
                alert('è¯·é€‰æ‹©æ¨¡å‹å¹¶è¾“å…¥æç¤ºè¯');
                return;
            }

            // ç¡®ä¿å·²ç»è°ƒè¯•è¿‡é…ç½®
            if (!window.debuggedConfigs) {
                alert('è¯·å…ˆç‚¹å‡»"ğŸ”§ è°ƒè¯•é…ç½®"æŒ‰é’®è§£æé…ç½®');
                return;
            }

            if (!window.debuggedConfigs[model]) {
                alert(`æœªæ‰¾åˆ°æ¨¡å‹ ${model} çš„é…ç½®ï¼Œè¯·æ£€æŸ¥è°ƒè¯•ç»“æœ`);
                return;
            }

            testButton.disabled = true;
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<div class="loading">ğŸ¤– æ­£åœ¨è°ƒç”¨ ${model} æ¨¡å‹...</div>`;

            try {
                const config = window.debuggedConfigs[model];
                console.log(`å¼€å§‹è°ƒç”¨æ¨¡å‹: ${model}`);
                console.log('ä½¿ç”¨é…ç½®:', {
                    endpoint: config.endpoint,
                    apiKey: config.apiKey.substring(0, 10) + '...',
                    maxTokens: config.maxTokens
                });
                
                const requestBody = {
                    messages: [
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    max_tokens: parseInt(config.maxTokens) || 4000,
                    temperature: 0.7
                };

                console.log('è¯·æ±‚ä½“:', requestBody);
                
                const response = await fetch(config.endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'api-key': config.apiKey
                    },
                    body: JSON.stringify(requestBody)
                });

                console.log('APIå“åº”çŠ¶æ€:', response.status);
                console.log('APIå“åº”å¤´:', Object.fromEntries(response.headers));

                const responseText = await response.text();
                console.log('APIå“åº”åŸå§‹æ–‡æœ¬:', responseText);

                if (!response.ok) {
                    throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status} ${response.statusText}\\nå“åº”: ${responseText}`);
                }

                const data = JSON.parse(responseText);
                console.log('APIå“åº”æ•°æ®:', data);
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>âœ… GPT API è°ƒç”¨æˆåŠŸï¼</h3>
                            <p><strong>ä½¿ç”¨æ¨¡å‹:</strong> ${model}</p>
                            <p><strong>å“åº”å†…å®¹:</strong></p>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0;">
                                ${data.choices[0].message.content}
                            </div>
                            <details>
                                <summary>å®Œæ•´å“åº”æ•°æ® (ç‚¹å‡»å±•å¼€)</summary>
                                <pre>${JSON.stringify(data, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    throw new Error('APIè¿”å›æ•°æ®æ ¼å¼é”™è¯¯ï¼Œæœªæ‰¾åˆ°é¢„æœŸçš„å“åº”ç»“æ„');
                }
                
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ GPT API è°ƒç”¨å¤±è´¥</h3>
                        <p><strong>é”™è¯¯:</strong> ${error.message}</p>
                        <details>
                            <summary>è¯¦ç»†é”™è¯¯ä¿¡æ¯ (ç‚¹å‡»å±•å¼€)</summary>
                            <pre>${error.stack || error.toString()}</pre>
                        </details>
                    </div>
                `;
            } finally {
                testButton.disabled = false;
            }
        }

        console.log('GPT API æµ‹è¯•å·¥å…·ï¼ˆä¿®å¤ç‰ˆï¼‰åŠ è½½å®Œæˆ');
        console.log('ä½¿ç”¨è¯´æ˜ï¼š');
        console.log('1. å…ˆç‚¹å‡»"ğŸ”§ è°ƒè¯•é…ç½®"è§£æé…ç½®æ–‡ä»¶');
        console.log('2. æŸ¥çœ‹å¯ç”¨æ¨¡å‹åˆ—è¡¨');
        console.log('3. é€‰æ‹©æ¨¡å‹å¹¶æµ‹è¯•APIè°ƒç”¨');
    </script>
</body>
</html>